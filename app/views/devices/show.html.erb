<p id="notice"><%= notice %></p>

<input type="hidden" id="device_id" value="<%= @device.id %>">

<div class="row">
<%= render("shared/device_card", device: @device, size: :edit, card_link: '' ) -%>
</div>

<!-- Nav tabs -->
<ul class="nav nav-tabs" role="tablist">
  <li class="active"><a href="#info" role="tab" data-toggle="tab">Details</a></li>
  <li><a href="#actions" role="tab" data-toggle="tab">Actions</a></li>
  <li><a href="#hive" role="tab" data-toggle="tab">Hive</a></li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  
<!-- Details tab -->
  <div role="tabpanel" class="tab-pane fade in active" id="info">
    <br />
    <table class="table">
    <% @device.details.each do |k,v| %>
      <tr>
      <th><%= k -%></th>
      <td>
      <% if v.class == Array %>
        <% v.each do |i| %>
          <%= i %><br />
        <% end %>
      <% elsif v.class == Hash %>
        <% v.each do |a,b| %>
          <%= "#{a}: #{b}" %><br />
        <% end %>
      <% else %>
        <%= v -%>
      <% end %>
      </td>
      </tr>
    <% end %>
    </table>
  </div>

<!-- Actions tab -->
  <div role="tabpanel" class="tab-pane fade" id="actions">

    <% if @device.plugin %>
    <%= render("shared/#{@device.device_type.downcase}_plugin_action_partial", device: @device) rescue nil -%>
    <% end %>

    <table id="actions_table" class="table">
      <thead>
        <tr>
          <th class="col-md-1">Executed</th>
          <th class="col-md-1">Type</th>
          <th class="redo_action">Body</th>
          <th class="col-md-1"></th>
        </tr>
      </thead>
      <tbody>
      <% @device.device_actions.reverse[0..4].each do |a| %>
        <tr>
          <td><%= a.executed_at || 'Pending' %></td>
          <td id="action_type-<%= a.id %>"><%= a.action_type %></td>
          <td id="body-<%= a.id %>"><%= a.body %></td>
          <td><% if a.executed_at %><button type="button" id="<%= a.id %>" class="btn btn-primary redo_action">
            <input type="hidden" class="redo_action_type" value="<%= a.action_type %>">
            <input type="hidden" class="redo_body" value="<%= a.body %>">
            Redo
          </button></span><% end %></td>
        </tr>
      <% end %>
      </tbody>
    </table>

  </div>

<!-- Hive tab -->
  <div role="tabpanel" class="tab-pane fade" id="hive">
    <br />
    <table class="table">
      <tr>
        <th class="col-md-1">Hive</th>
        <td>
          <div class="dropdown">
            <% h = HiveMindHive::Plugin.find_by_connected_device(@device) %>
            <button id="select-hive" class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"><%= h.nil? ? '[Disconnected]' : h.name %>
            <span class="caret"></span></button>
            <ul class="dropdown-menu hive-select-menu">
              <input type="hidden" class="hive_id" value="<%= h.nil? ? nil : h.id     %>">
              <li><a href="#" id="disconnect">[Disconnected]</a></li>
              <% all_hives.each do |h| %>
              <li><a href="#" id="<%=h.id %>"><%= h.name %></a></li>
              <% end %>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <th class="col-md-1">Queues</th>
        <td>
          <select id="hive-queues" multiple="multiple" onchange="hive_queues_update()">
          <% HiveQueue.all.each do |hq| %>
            <option value="<%= hq.name %>"<%= (@device.hive_queues.include? hq) ? ' selected="selected"' : '' %>><%= hq.name %></option>
          <% end %>
            <option id="new-hive-queue" value="Enter new queue name ...">Enter new queue name ...</option>
          </select>
        </td>
      </tr>
    </table>
    <script type="text/javascript">
      $(document).ready(function() {
        $('#hive-queues').multiselect('select', null, true);
      });
    </script>
  </div>

</div>

